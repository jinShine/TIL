# 2.Fetch API & CORS

* Fetch API ë€
* Promise
* ReadableStream
* Unicode
* CORS ë€\


### 1. Fetch APIë€

Fetch APIëŠ” ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í¬í•¨í•œ ë¦¬ì†ŒìŠ¤ ì·¨ë“ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ë©°, [`XMLHttpRequest`](https://developer.mozilla.org/ko/docs/Web/API/XMLHttpRequest)ë³´ë‹¤ ê°•ë ¥í•˜ê³  ìœ ì—°í•œ ëŒ€ì²´ì œì…ë‹ˆë‹¤.

#### ê¸°ë³¸ì ì¸ Fetch ìš”ì²­

```js
fetch('http://example.com/movies.json')
  .then((response) => response.json())
  .then((data) => console.log(data));
```



### 2. Promise

[Promise](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global\_Objects/Promise) ê°ì²´ëŠ” ë¹„ë™ê¸° ì‘ì—…ì´ ë§ì´í•  ë¯¸ë˜ì˜ **ì™„ë£Œ** ë˜ëŠ” **ì‹¤íŒ¨**ì™€ ê·¸ **ê²°ê³¼ ê°’**ì„ ë‚˜íƒ€ëƒ„\
ë¹„ë™ê¸° ì—°ì‚°ì´ ì¢…ë£Œëœ ì´í›„ì— **ê²°ê³¼ ê°’ê³¼ ì‹¤íŒ¨ ì‚¬ìœ **ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì²˜ë¦¬ê¸°ë¥¼ ì—°ê²°í•  ìˆ˜ ìˆìŒ\
í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë¹„ë™ê¸° ë©”ì†Œë“œì—ì„œ **ë™ê¸° ë©”ì†Œë“œì²˜ëŸ¼ ê°’ì„ ë°˜í™˜**í•  ìˆ˜ ìˆìŒ\
ê·¸ë ‡ì§€ë§Œ ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³ , ë¯¸ë˜ì˜ ì–´ë–¤ ì‹œì ì— **ê²°ê³¼ë¥¼ ì œê³µí•˜ê² ë‹¤ëŠ” ì•½ì†(í”„ë¡œë¯¸ìŠ¤)ì„ ë°˜í™˜**

#### Promiseì˜ ìƒíƒœ

PromiseëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ìƒíƒœë¥¼ ê°€ì§

* ëŒ€ê¸°(pending): ì´í–‰í•˜ì§€ë„, ê±°ë¶€í•˜ì§€ë„ ì•Šì€ ì´ˆê¸° ìƒíƒœ
* ì´í–‰(fulfilled): ì—°ì‚°ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë¨
* ê±°ë¶€(rejected): ì—°ì‚°ì´ ì‹¤íŒ¨í•¨



### 3. ReadableStream

> [ReadableStream](https://developer.mozilla.org/ko/docs/Web/API/ReadableStream)

Streams APIì˜ ReadableStream ì¸í„°í˜ì´ìŠ¤ëŠ” ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” ìŠ¤íŠ¸ë¦¼ì„ ì œê³µ\
**Fetch AP**IëŠ” Response ê°ì²´ì˜ body ì†ì„±ì„ í†µí•´ ReadableStreamì˜ êµ¬ì²´ì ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì œê³µ



#### ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•

ReadableStreamì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ìš°ì„  `getReader()`ë¡œ ì–»ì–´ì˜¨ í›„ ì§„í–‰

```js
fetch('http://localhost:3000/products');
// â†’ Promise

await fetch('http://localhost:3000/products');
// â†’ Response

const response = await fetch('http://localhost:3000/products');
// â†’ response.bodyëŠ” ReadableStream

const reader = response.body.getReader();

const chunk = await reader.read();
// â†’ chunk.valueëŠ” Uint8Array íƒ€ì…
// â†’ ì›ë˜ëŠ” chunk.doneì´ trueì¼ ë•Œê¹Œì§€ ë°˜ë³µí•´ì•¼ í•¨

const body = new TextDecoder().decode(chunk.value);

const data = JSON.parse(body);
```

* `chunk.value`ëŠ” Uint8Array íƒ€ì…ì´ê¸° ë•Œë¬¸ì— stringìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼ í•¨
* [í…ìŠ¤íŠ¸ ë””ì½”ë”ì™€ í…ìŠ¤íŠ¸ ì¸ì½”ë”](https://ko.javascript.info/text-decoder)
* TextDecoderëŠ” ì£¼ì–´ì§„ ë²„í¼ì™€ ì¸ì½”ë”©ìœ¼ë¡œ ê°’ì„ ì‹¤ì œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ìì—´ë¡œ ì½ì„ ìˆ˜ ìˆê²Œ í•´ì¤Œ

#### JSONì„ ê¸°ë³¸ ì§€ì›

```js
const response = await fetch('http://localhost:3000/products');
const data = await response.json();
```

#### ë‹¤ë¥¸ HTTP Methodë¥¼ ì“°ê³  ì‹¶ì„ ê²½ìš°

```js
const response = fetch(url, {
    method: 'POST',
});
```

#### í…ìŠ¤íŠ¸ íŒŒì¼ í•œ ì¤„ì”© ì²˜ë¦¬í•˜ê¸°

ì‘ë‹µì—ì„œ ì½ì–´ì˜¤ëŠ” ë°ì´í„° ì²­í¬(chunk)ëŠ” ì¤„ ë‹¨ìœ„ë¡œ ê¹”ë”í•˜ê²Œ ë‚˜ë‰˜ì§€ ì•Šìœ¼ë©°, Uint8Array í˜•íƒœ(ë¬¸ìì—´ X)\
í…ìŠ¤íŠ¸ íŒŒì¼ì„ ê°€ì ¸ì™€ì„œ ì¤„ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ë ¤ë©´, 'ì¤„' ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ëŠ” ì‘ì—…ì€ ì§ì ‘ êµ¬í˜„í•´ì•¼&#x20;





### 4. Unicode

> [ìœ ë‹ˆì½”ë“œ](https://ko.wikipedia.org/wiki/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C)

ìœ ë‹ˆì½”ë“œ(Unicode)ëŠ” ì „ ì„¸ê³„ì˜ ëª¨ë“  ë¬¸ìë¥¼ **ì»´í“¨í„°ì—ì„œ ì¼ê´€ë˜ê²Œ í‘œí˜„**í•˜ê³  ë‹¤ë£° ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ ì‚°ì—… í‘œì¤€

ê¸°ì¡´ ì¸ì½”ë”©ì˜ ê·œëª¨ë‚˜ ë²”ìœ„ ë©´ì—ì„œ í•œì •ë˜ì–´ ìˆê³ , ë‹¤êµ­ì–´ í™˜ê²½ì—ì„œëŠ” ì„œë¡œ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë¬¸ì œì ì„ í•´ê²°

> ğŸŒ **ISO(êµ­ì œ í‘œì¤€í™” ê¸°êµ¬)**
>
> International Organization for Standardization\
> ì—¬ëŸ¬ ë‚˜ë¼ì˜ í‘œì¤€ ì œì • ë‹¨ì²´ë“¤ì˜ ëŒ€í‘œë“¤ë¡œ ì´ë£¨ì–´ì§„ êµ­ì œì ì¸ í‘œì¤€í™” ê¸°êµ¬\
> ë‚˜ë¼ë§ˆë‹¤ ë‹¤ë¥¸ ì‚°ì—…, í†µìƒ í‘œì¤€ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ **êµ­ì œì ìœ¼ë¡œ í†µìš©ë˜ëŠ” í‘œì¤€ì„ ê°œë°œí•˜ê³  ë³´ê¸‰**





### 5. CORS

#### ë™ì¼ ì¶œì²˜ ì •ì±…(Same Origin Policy)

ë™ì¼ ì¶œì²˜ ì •ì±…(same-origin policy)ì€ ì–´ë–¤ ì¶œì²˜ì—ì„œ ë¶ˆëŸ¬ì˜¨ ë¬¸ì„œë‚˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹¤ë¥¸ ì¶œì²˜ì—ì„œ ê°€ì ¸ì˜¨ ë¦¬ì†ŒìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê²ƒì„ ì œí•œí•˜ëŠ” ì¤‘ìš”í•œ ë³´ì•ˆ ë°©ì‹



ì¦‰, ë™ì¼ ì¶œì²˜ ì •ì±…ì´ë€ ê°™ì€ Origin ì¶œì²˜ì˜ ì„œë²„ë¡œë§Œ ìš”ì²­ì„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

* `http://www.same-domain.com/` --> `http://www.same-domain.com` = `same-origin`
* `http://www.same-domain.com` -/-> `http://www.cross-domain.com` = `cross-origin`

> **Origin = Protocol(http, https ë“±) + host name(example.com) + port(3000, 8080 ë“±)**



#### êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ  (Cross-Origin Resource Sharing)

_Same-Origin Policyì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ì •ì±…ì¸ ë§Œí¼_ **CORSë€ cross-Origin ì¦‰, ì¶œì²˜ê°€ ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œì˜ AJAXìš”ì²­ì´ë¼ë„ ì„œë²„ ë‹¨ì—ì„œ ë°ì´í„° ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•˜ëŠ” ì •ì±…**

HTTP í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ê°€ í•œ ì¶œì²˜ì—ì„œ ì‹¤í–‰ì¤‘ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì„ íƒëœ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜

1.  Access-Control-Allow-Origin response header

    Access-Control-Allow-Origin ì‘ë‹µ í—¤ë”ëŠ” ì´ ì‘ë‹µì´ ì£¼ì–´ì§„ originìœ¼ë¡œë¶€í„°ì˜ ìš”ì²­ ì½”ë“œì™€ ê³µìœ ë  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.\
    ì„œë²„ì¸¡ ì‘ë‹µì—ì„œ ì ‘ê·¼ ê¶Œí•œì„ ì£¼ëŠ” í—¤ë”ë¥¼ ì¶”ê°€í•´ cors ì—ëŸ¬ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•.

```js
app.use((req, res, next) => {
    res.header("Access-Control-Allow-Origin", "*"); // ëª¨ë“  ë„ë©”ì¸
    res.header("Access-Control-Allow-Origin", "https://example.com"); // íŠ¹ì • ë„ë©”ì¸
});
```

2.  [Node.js Express ë¯¸ë“¤ì›¨ì–´ CORS](https://www.npmjs.com/package/cors)

    ë¯¸ë“¤ì›¨ì–´ corsëŠ” ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì— ë‚´ê°€ ì‚¬ìš©í–ˆë˜ ë°©ì‹ì´ë‹¤. ë¬¸ì„œê°€ ë§¤ìš° ì¹œì ˆí•˜ê²Œ ë˜ì–´ìˆì–´ ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš© ë° ì˜µì…˜ ì„¤ì •ì´ ì–´ë µì§€ ì•Šë‹¤.

```null
npm i cors
npm i -D @types/cors
```

```js
import express from 'express';
import cors from 'cors';

const app = express();

app.use(cors());
```
